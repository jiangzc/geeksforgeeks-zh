<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head><title></title>
<link href="../../../styles/ebook.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<header class="entry-header">
						<h1 class="entry-title">Packet flow in the same network</h1>
				
						</header>
<!-- .entry-header -->
				<div class="entry-content">
			<p>Prerequisite – <a href="https://www.geeksforgeeks.org/computer-network-arp-works/" rel="noopener" target="_blank">How ARP works?</a><br/>
To transfer a packet from source to destination both destination MAC address and IP address should be known. If the destination  MAC address is not present then first ARP will be resolved first then the packet will be delivered to destination host.</p>
<p>There are  simple rules for a packet flow in a network:</p>
<ol>
<li>If the destination is present in the same network of the source host then the packet will be delivered directly to the destination host using MAC address.</li>
<li>Within a network, the packet will be delivered on the basis of MAC address.</li>
<li>MAC address never crosses its broadcast domain.</li>
</ol>
<p>Now, first we have to take an idea about ARP.</p>
<p><b>Address Resolution Protocol –</b><br/>
Address Resolution Protocol is a layer 2(Data link layer) protocol which is used to find MAC address of the known IP address.</p>
<p>There are some important terms associated with ARP:</p>
<br/>
        
          <!-- post_top_responsive -->
          <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9465609616171866" data-ad-slot="4501693235" data-ad-format="auto"></ins>
          
        <br/>
            
<p><b>ARP cache </b> is a table maintained by ARP which contains IP address with its associated MAC address and type. If MAC address is learned dynamically then the type will be dynamic and if MAC address is added manually then type will be static. </p>
<p><img src="../../../imgs/net/d5f11ea10b9923d9fd98f0851f18f85b.jpg" width="517" height="247" class="aligncenter size-full"/></p>
<p><b>ARP request </b> is a broadcast message generated by the source to find the destination MAC address if the ARP is not resolved initially.</p>
<p><b>ARP reply </b> is a unicast message from destination to source device containing the destination MAC address. </p>
<p><b>Explanation –</b></p>
<p><img src="../../../imgs/net/322b7f7cd3f4464e9eb0f9e7465ffe66.jpg" alt=""/></p>
<p>The steps included in ARP process are as follows :-</p>
<p>When a source wants to send a packet to destination device then, </p>
<ol>
<li>The source ARP cache is check if the ARP is resolved or not. If the ARP is not resolved, it puts the packet on hold and generates an ARP request.
<p><img src="../../../imgs/net/269617c3095e82470996585353338f86.jpg" width="616" height="485" class="aligncenter size-full"/></p>
<p>If the ARP is already resolved then the packet will be delivered to destination host. </p></li>
<li>The ARP request is broadcast all over the network to find out the device having destination IP address.<br/>
<strong>Note –</strong> If the destination is present in the same network then ARP will find out destination MAC address but if it is present in different network then ARP will find out default gateway MAC address. <p></p>
<p><img src="../../../imgs/net/e94f1aa324f334560a1b8ff39e922970.jpg" width="604" height="466" class="aligncenter size-full"/>
</p></li>
<li>When the device having the destination IP address receives the ARP request, it updates it’s own ARP cache. </li>
<li>The destination host machine generates an ARP reply containing it’s own MAC address. </li>
<li>Now,the device having the source IP address receives the ARP reply and update  it’s ARP cache.
<p><img src="../../../imgs/net/79e2b9f98a0e214dc7dd04944f8cf429.jpg" width="611" height="464" class="aligncenter size-full"/></p></li>
<li>Since,both source and destination IP address and MAC address are available now therefore the packet is delivered to the destination host. </li>
</ol>
<p>Now, we have taken an idea about the ARP protocol. Let’s see about the <b>packet flow</b>.</p>
<p>Now we will understand how the packet is delivered to destination when the destination is present in same network(network of the source).</p>
<p><img src="../../../imgs/net/217a775c578742b0f9075079639a645e.jpg" alt=""/></p>
<p>Here is the topology in which host A having IP address 192.168.1.1, host B having IP address 192.168.1.2 and the router having IP address 192.168.1.3 on interface fa0/0.</p>
<p>Now how source device will know that the destination is present in same or different network. Let us understand :-</p>
<p><b>AND operation</b> is performed between source IP address,  source subnet mask and destination IP address, source subnet mask. If the resultant of both is same then the destination is present in the same network otherwise in different network. </p>
<p>Let us try to ping host B from host A.</p>
<p><img src="../../../imgs/net/a95d39825153290addff4a789957185f.jpg" alt=""/></p>
<p>As you can see 2 packets are generated, one of ICMP and the other of ARP(green). ARP frame is generated because the host A has not yet communicated to host B i.e. the ARP has not been resolved i.e ARP will be resolved first so that host A have an entry for host B MAC address.</p>
<p><img src="../../../imgs/net/50f2dbbff2355da2ee727605e588deda.jpg" alt=""/></p>
<p>As already explained the ARP request will be broadcast first for the target IP address within the network because routers do not forward broadcast packet.The broadcast request is recieved by the switch as shown in the above figure. </p>
<p><img src="../../../imgs/net/c9edc68e1b5da9b5bff05498a4fbf306.jpg" width="538" height="569" class="aligncenter size-full"/></p>
<p>The switch broadcast the ARP request as the entry in the ethernet header is FFFF.FFFF.FFFF (broadcast MAC address).</p>
<p><img src="../../../imgs/net/1e68baec190c4e1ae07dd87ae1f4e16c.jpg" alt=""/></p>
<p>The request is recieved by host B as shown in the above figure.The host B generates an ARP reply immediately specifying its own MAC address.</p>
<p><img src="../../../imgs/net/50f2dbbff2355da2ee727605e588deda.jpg"/></p>
<p><img src="../../../imgs/net/c6cf17b7d0c3f9d46f10eb831f263206.jpg" alt=""/></p>
<p>Now the host B unicast the ARP reply to the host A which is recieved by the switch which in turn forward it to the host A as shown in the above 2 figures.</p>
<p><strong>Note –</strong><br/>
The switch is able to unicast the reply because the switch has put an entry for host A in it MAC table when the host A broadcast the ARP request.in the same way,switch has also put an entry for the host B when the switch recieves the ARP reply.</p>
<p><img src="../../../imgs/net/8c49fb62452397f3f830af92ebaf707f.jpg"/><br/>
<img src="../../../imgs/net/3fbd442b5fc62c5999f67cd0aa5ca539.jpg"/></p>
<p>Now the ARP has been resolved and the ICMP will be unicast to the host B from host A(as shown above).</p>
<p><img src="../../../imgs/net/8c49fb62452397f3f830af92ebaf707f.jpg"/><br/>
<img src="../../../imgs/net/adb77bfea35bbd83d9dfeb4e790afca3.jpg"/><br/>
Now the ICMP akcnowledgement packet will be unicast from host B to host A i.e. host B is successfully ping from host A as shown in the above figures.</p>
<br/>
          <!-- post_bottom_responsive -->
          <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9465609616171866" data-ad-slot="8385097921" data-ad-format="auto"></ins>
          
            <br/><br/><hr/>

<hr/>

					
		
<!-- .entry-meta -->	</div>
</body>
</html>