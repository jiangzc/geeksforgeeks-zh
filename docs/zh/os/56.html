<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-x-mtfrom-en"><head><meta http-equiv="X-Translated-By" content="Google"><link href="https://apachecn.github.io/geeksforgeeks-zh/docs/en/os/56.html" hreflang="en" rel="alternate machine-translated-from"><title></title><link href="../../../styles/ebook.css" type="text/css" rel="stylesheet"></head><body><header class="entry-header"><h1 class="entry-title"> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x8BFB;&#x8005; - &#x4F5C;&#x5BB6;&#x95EE;&#x9898;|</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x7B2C;1&#x7EC4;&#xFF08;&#x7B80;&#x4ECB;&#x548C;&#x8BFB;&#x8005;&#x504F;&#x597D;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF09;</span> </h1></header><!-- .entry-header --><div class="entry-content"><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x8003;&#x8651;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x5728;&#x5F88;&#x591A;&#x4EBA;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#x7684;&#x60C5;&#x51B5;&#x3002;</span> </p><ul><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x4EBA;&#x5C1D;&#x8BD5;&#x7F16;&#x8F91;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x5176;&#x4ED6;&#x4EBA;&#x4E0D;&#x5E94;&#x540C;&#x65F6;&#x9605;&#x8BFB;&#x6216;&#x4E66;&#x5199;&#xFF0C;&#x5426;&#x5219;&#x4ED6;/&#x5979;&#x5C06;&#x65E0;&#x6CD5;&#x770B;&#x5230;&#x66F4;&#x6539;&#x3002;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x67D0;&#x4EBA;&#x6B63;&#x5728;&#x9605;&#x8BFB;&#x8BE5;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x5176;&#x4ED6;&#x4EBA;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x9605;&#x8BFB;&#x8BE5;&#x6587;&#x4EF6;&#x3002;</span> </li></ul><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x6B63;&#x662F;&#x5728;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x79F0;&#x4E3A;<strong>&#x8BFB;&#x8005; - &#x4F5C;&#x8005;&#x95EE;&#x9898;</strong></span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x95EE;&#x9898;&#x53C2;&#x6570;&#xFF1A;</span> </p><ul><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x4E00;&#x7EC4;&#x6570;&#x636E;&#x5728;&#x8BB8;&#x591A;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x4E00;&#x65E6;&#x4F5C;&#x5BB6;&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x6267;&#x884C;&#x5199;&#x4F5C;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x4E00;&#x6B21;&#x53EA;&#x80FD;&#x5199;&#x4E00;&#x4F4D;&#x4F5C;&#x5BB6;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x8FDB;&#x7A0B;&#x6B63;&#x5728;&#x7F16;&#x5199;&#xFF0C;&#x5219;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x5B83;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x8BFB;&#x8005;&#x6B63;&#x5728;&#x9605;&#x8BFB;&#xFF0C;&#x5219;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x5199;&#x5165;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x8BFB;&#x8005;&#x53EF;&#x80FD;&#x4E0D;&#x4F1A;&#x5199;&#xFF0C;&#x53EA;&#x80FD;&#x9605;&#x8BFB;</span> </li></ul><p style="text-align: center"> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <strong>Reader&#x5177;&#x6709;Priority over Writer&#x65F6;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</strong></span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x4F18;&#x5148;&#x7EA7;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x6253;&#x5F00;&#x5171;&#x4EAB;&#x8BFB;&#x53D6;&#xFF0C;&#x5219;&#x8BFB;&#x8005;&#x4E0D;&#x5E94;&#x8BE5;&#x7B49;&#x5F85;&#x3002;</span> </p><br><!-- post_top_responsive --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9465609616171866" data-ad-slot="4501693235" data-ad-format="auto"></ins><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x4F7F;&#x7528;&#x4E09;&#x4E2A;&#x53D8;&#x91CF;&#xFF1A; <strong>mutex&#xFF0C;wrt&#xFF0C;readcnt</strong>&#x6765;&#x5B9E;&#x73B0;&#x89E3;&#x51B3;&#x65B9;&#x6848;</span> </p><ol><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <strong>&#x4FE1;&#x53F7;&#x91CF;</strong>&#x4E92;&#x65A5;<strong>&#x91CF;</strong> &#xFF0C;wrt;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> //&#x4FE1;&#x53F7;&#x91CF;<strong>&#x4E92;&#x65A5;</strong>&#x7528;&#x4E8E;&#x786E;&#x4FDD;&#x66F4;&#x65B0;<strong>readcnt</strong>&#x65F6;&#x7684;<strong>&#x4E92;&#x65A5;</strong> &#xFF0C;&#x5373;&#x5F53;&#x4EFB;&#x4F55;&#x8BFB;&#x8005;&#x8FDB;&#x5165;&#x6216;&#x9000;&#x51FA;&#x4E34;&#x754C;&#x533A;&#x65F6;&#xFF0C;&#x8BFB;&#x8005;&#x548C;&#x4F5C;&#x8005;&#x90FD;&#x4F7F;&#x7528;&#x4FE1;&#x53F7;&#x91CF;<strong>wrt</strong></span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <strong>int</strong> readcnt;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> // <strong>readcnt</strong>&#x544A;&#x8BC9;&#x4E34;&#x754C;&#x533A;&#x4E2D;&#x6267;&#x884C;&#x8BFB;&#x53D6;&#x7684;&#x8FDB;&#x7A0B;&#x6570;&#xFF0C;&#x6700;&#x521D;&#x4E3A;0</span> </li></ol><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <strong>sempahore&#x7684;&#x529F;&#x80FD;&#xFF1A;</strong></span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> -  wait&#xFF08;&#xFF09;&#xFF1A;&#x9012;&#x51CF;&#x4FE1;&#x53F7;&#x91CF;&#x503C;&#x3002;</span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> -  signal&#xFF08;&#xFF09;&#xFF1A;&#x9012;&#x589E;&#x4FE1;&#x53F7;&#x91CF;&#x503C;&#x3002;</span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <strong>&#x4F5C;&#x5BB6;&#x6D41;&#x7A0B;&#xFF1A;</strong></span> </p><ol><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> Writer&#x8BF7;&#x6C42;&#x8FDB;&#x5165;&#x5173;&#x952E;&#x90E8;&#x5206;&#x3002;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x5141;&#x8BB8;&#xFF0C;&#x5373;wait&#xFF08;&#xFF09;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x771F;&#x503C;&#xFF0C;&#x5B83;&#x8FDB;&#x5165;&#x5E76;&#x6267;&#x884C;&#x5199;&#x5165;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x4E0D;&#x5141;&#x8BB8;&#xFF0C;&#x5B83;&#x4F1A;&#x7EE7;&#x7EED;&#x7B49;&#x5F85;&#x3002;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5B83;&#x9000;&#x51FA;&#x4E86;&#x5173;&#x952E;&#x90E8;&#x5206;&#x3002;</span> </li></ol><pre> <span class="pre-span" style="direction: ltr; text-align: left">do {</span>
    <span class="pre-span" style="direction: ltr; text-align: left">// writer requests for critical section</span>
    <span class="pre-span" style="direction: ltr; text-align: left">wait(wrt);</span>  
   
    <span class="pre-span" style="direction: ltr; text-align: left">// performs the write</span>

    <span class="pre-span" style="direction: ltr; text-align: left">// leaves the critical section</span>
    <span class="pre-span" style="direction: ltr; text-align: left">signal(wrt);</span>

<span class="pre-span" style="direction: ltr; text-align: left">} while(true);</span> </pre><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <strong>&#x8BFB;&#x8005;&#x6D41;&#x7A0B;&#xFF1A;</strong></span> </p><ol><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x8BFB;&#x8005;&#x8981;&#x6C42;&#x8FDB;&#x5165;&#x5173;&#x952E;&#x90E8;&#x5206;&#x3002;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x5141;&#x8BB8;&#x7684;&#x8BDD;&#xFF1A;</span> <ul><li style="text-align: left"> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5B83;&#x4F1A;&#x589E;&#x52A0;&#x5173;&#x952E;&#x90E8;&#x5206;&#x5185;&#x7684;&#x8BFB;&#x8005;&#x6570;&#x91CF;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x9605;&#x8BFB;&#x5668;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x5165;&#x7684;&#x9605;&#x8BFB;&#x5668;&#xFF0C;&#x5B83;&#x4F1A;&#x9501;&#x5B9A;<strong>wrt</strong>&#x4FE1;&#x53F7;&#x91CF;&#x4EE5;&#x9650;&#x5236;&#x4F5C;&#x8005;&#x7684;&#x8F93;&#x5165;&#xFF08;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x4F55;&#x9605;&#x8BFB;&#x5668;&#x5728;&#x91CC;&#x9762;&#xFF09;&#x3002;</span> </li><li style="text-align: left"> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x7136;&#x540E;&#xFF0C;&#x5F53;&#x5176;&#x4ED6;&#x8BFB;&#x8005;&#x88AB;&#x5141;&#x8BB8;&#x8FDB;&#x5165;&#x800C;&#x5176;&#x4ED6;&#x8BFB;&#x8005;&#x5DF2;&#x7ECF;&#x9605;&#x8BFB;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x53D1;&#x51FA;&#x4E92;&#x65A5;&#x4FE1;&#x53F7;&#x3002;</span> </li><li style="text-align: left"> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x6267;&#x884C;&#x8BFB;&#x53D6;&#x540E;&#xFF0C;&#x5B83;&#x9000;&#x51FA;&#x4E34;&#x754C;&#x533A;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5F53;&#x9000;&#x51FA;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x68C0;&#x67E5;&#x5185;&#x90E8;&#x662F;&#x5426;&#x6CA1;&#x6709;&#x66F4;&#x591A;&#x7684;&#x9605;&#x8BFB;&#x5668;&#xFF0C;&#x5B83;&#x4F1A;&#x50CF;&#x73B0;&#x5728;&#x4E00;&#x6837;&#x53D1;&#x4FE1;&#x53F7;&#x901A;&#x77E5;&#x201C;wrt&#x201D;&#xFF0C;&#x4F5C;&#x8005;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;&#x4E34;&#x754C;&#x533A;&#x3002;</span> </li></ul></li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x4E0D;&#x5141;&#x8BB8;&#xFF0C;&#x5B83;&#x4F1A;&#x7EE7;&#x7EED;&#x7B49;&#x5F85;&#x3002;</span> </li></ol><pre> <span class="pre-span" style="direction: ltr; text-align: left">do {</span>
    
   <span class="pre-span" style="direction: ltr; text-align: left">// Reader wants to enter the critical section</span>
   <span class="pre-span" style="direction: ltr; text-align: left">wait(mutex);</span>

   <span class="pre-span" style="direction: ltr; text-align: left">// The number of readers has now increased by 1</span>
   <span class="pre-span" style="direction: ltr; text-align: left">readcnt++;</span> 

   <span class="pre-span" style="direction: ltr; text-align: left">// there is atleast one reader in the critical section</span>
   <span class="pre-span" style="direction: ltr; text-align: left"><strong>// this ensure no writer can enter if there is even one reader</strong></span>
   <span class="pre-span" style="direction: ltr; text-align: left"><strong>// thus we give preference to readers here</strong></span>
   <span class="pre-span" style="direction: ltr; text-align: left">if (readcnt==1)</span>     
      <span class="pre-span" style="direction: ltr; text-align: left">wait(wrt);</span>         

   <span class="pre-span" style="direction: ltr; text-align: left">// other readers can enter while this current reader is inside</span> 
   <span class="pre-span" style="direction: ltr; text-align: left">// the critical section</span>
   <span class="pre-span" style="direction: ltr; text-align: left">signal(mutex);</span> 

   <span class="pre-span" style="direction: ltr; text-align: left">// current reader performs reading here</span>
   <span class="pre-span" style="direction: ltr; text-align: left">wait(mutex);</span> <span class="pre-span" style="direction: ltr; text-align: left">// a reader wants to leave</span>

   <span class="pre-span" style="direction: ltr; text-align: left">readcnt--;</span>

   <span class="pre-span" style="direction: ltr; text-align: left">// that is, no reader is left in the critical section,</span>
   <span class="pre-span" style="direction: ltr; text-align: left">if (readcnt == 0)</span> 
       <span class="pre-span" style="direction: ltr; text-align: left">signal(wrt);</span> <span class="pre-span" style="direction: ltr; text-align: left">// writers can enter</span>

   <span class="pre-span" style="direction: ltr; text-align: left">signal(mutex);</span> <span class="pre-span" style="direction: ltr; text-align: left">// reader leaves</span>

<span class="pre-span" style="direction: ltr; text-align: left">} while(true);</span> </pre><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x56E0;&#x6B64;&#xFF0C;&#x4E92;&#x65A5;&#x4F53;&apos; <strong>wrt</strong> &apos;&#x5728;&#x8BFB;&#x8005;&#x548C;&#x4F5C;&#x8005;&#x4E0A;&#x6392;&#x961F;&#xFF0C;&#x4F7F;&#x5F97;&#x5982;&#x679C;&#x4F5C;&#x8005;&#x4E5F;&#x5728;&#x90A3;&#x91CC;&#xFF0C;&#x5219;&#x4F18;&#x5148;&#x8003;&#x8651;&#x8BFB;&#x8005;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x56E0;&#x6B64;&#xFF0C;&#x6CA1;&#x6709;&#x8BFB;&#x8005;&#x53EA;&#x662F;&#x56E0;&#x4E3A;&#x4F5C;&#x5BB6;&#x8981;&#x6C42;&#x8FDB;&#x5165;&#x4E34;&#x754C;&#x533A;&#x800C;&#x7B49;&#x5F85;&#x3002;</span> </p><!-- post_bottom_responsive --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9465609616171866" data-ad-slot="8385097921" data-ad-format="auto"></ins><br><br><!-- .entry-meta --></div></body></html>