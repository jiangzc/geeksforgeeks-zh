<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-x-mtfrom-en"><head><meta http-equiv="X-Translated-By" content="Google"><link href="https://apachecn.github.io/geeksforgeeks-zh/docs/en/os/53.html" hreflang="en" rel="alternate machine-translated-from"><title></title><link href="../../../styles/ebook.css" type="text/css" rel="stylesheet"></head><body><header class="entry-header"><h1 class="entry-title"> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x9762;&#x5305;&#x5E97;&#x7B97;&#x6CD5;</span> </h1></header><!-- .entry-header --><div class="entry-content"><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5148;&#x51B3;&#x6761;&#x4EF6; - <a href="https://www.geeksforgeeks.org/g-fact-70/" rel="noopener" target="_blank">&#x5173;&#x952E;&#x90E8;&#x5206;</a> &#xFF0C; <a href="https://www.geeksforgeeks.org/process-synchronization-set-1/" rel="noopener" target="_blank">&#x8FC7;&#x7A0B;&#x540C;&#x6B65;</a> &#xFF0C; <a href="https://www.geeksforgeeks.org/inter-process-communication/" rel="noopener" target="_blank">&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;</a></span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5BF9;&#x4E8E;N&#x8FC7;&#x7A0B;&#x7684;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#xFF0C; <b>Bakery&#x7B97;&#x6CD5;</b>&#x662F;&#x5BF9;&#x4E8E;&#x4E92;&#x65A5;&#x95EE;&#x9898;&#x6700;&#x7B80;&#x5355;&#x7684;&#x5DF2;&#x77E5;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4E4B;&#x4E00;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x70D8;&#x7119;&#x7B97;&#x6CD5;&#x662F;<strong>N&#x4E2A;</strong>&#x8FC7;&#x7A0B;&#x7684;&#x5173;&#x952E;&#x90E8;&#x5206;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x8BE5;&#x7B97;&#x6CD5;&#x4FDD;&#x7559;&#x4E86;&#x5148;&#x5230;&#x5148;&#x670D;&#x52A1;&#x5C5E;&#x6027;&#x3002;</span> </p><ul><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5728;&#x8FDB;&#x5165;&#x5176;&#x5173;&#x952E;&#x90E8;&#x5206;&#x4E4B;&#x524D;&#xFF0C;&#x8BE5;&#x8FC7;&#x7A0B;&#x4F1A;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x6700;&#x5C0F;&#x6570;&#x5B57;&#x7684;&#x6301;&#x6709;&#x8005;&#x8FDB;&#x5165;&#x4E34;&#x754C;&#x533A;&#x3002;</span> </li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x8FDB;&#x7A0B;Pi&#x548C;Pj&#x6536;&#x5230;&#x76F8;&#x540C;&#x7684;&#x6570;&#x5B57;&#xFF0C;</span> <pre> <span class="pre-span" style="direction: ltr; text-align: left">if i &lt; j</span> 
<span class="pre-span" style="direction: ltr; text-align: left">Pi is served first;</span> 
<span class="pre-span" style="direction: ltr; text-align: left">else</span> 
<span class="pre-span" style="direction: ltr; text-align: left">Pj is served first.</span> </pre></li><li> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x7F16;&#x53F7;&#x65B9;&#x6848;&#x603B;&#x662F;&#x4EE5;&#x9012;&#x589E;&#x7684;&#x987A;&#x5E8F;&#x751F;&#x6210;&#x6570;&#x5B57;;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5373;&#xFF0C;1,2,3,3,3,3,4,5 ......</span> </li></ul><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <b>&#x7B26;&#x53F7; -</b>&#x8BCD;&#x5178;&#x987A;&#x5E8F;&#xFF08;&#x7968;&#x53F7;&#xFF03;&#xFF0C;&#x8FDB;&#x7A0B;&#x53F7;&#x7801;&#xFF03;&#xFF09; - &#x9996;&#x5148;&#x6BD4;&#x8F83;&#x7968;&#x53F7;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5982;&#x679C;&#x76F8;&#x540C;&#xFF0C;&#x5219;&#x63A5;&#x4E0B;&#x6765;&#x6BD4;&#x8F83;&#x8FC7;&#x7A0B;ID&#xFF0C;&#x5373; - </span> </p><pre> <span class="pre-span" style="direction: ltr; text-align: left">&#x2013; (a, b) &lt; (c, d) if a &lt; c or if a = c and b &lt; d</span>
<span class="pre-span" style="direction: ltr; text-align: left">&#x2013; max(a [0], . . ., a [n-1]) is a number, k, such that k &gt;= a[i] for i = 0, .</span> <span class="pre-span" style="direction: ltr; text-align: left">.</span> <span class="pre-span" style="direction: ltr; text-align: left">., n - 1</span> </pre><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5171;&#x4EAB;&#x6570;&#x636E; - &#x9009;&#x62E9;&#x662F;&#x5E03;&#x5C14;&#x503C;&#x7684;&#x6570;&#x7EC4;[0..n  -  1];</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> &#xFF06;number&#x662F;&#x6574;&#x6570;&#x503C;&#x7684;&#x6570;&#x7EC4;[0..n  -  1]&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x4E24;&#x8005;&#x5206;&#x522B;&#x521D;&#x59CB;&#x5316;&#x4E3A;<strong>False&#x548C;Zero</strong> &#x3002;</span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <strong>&#x7B97;&#x6CD5;&#x4F2A;&#x7801; - </strong></span> </p><pre> <span class="pre-span" style="direction: ltr; text-align: left">repeat</span>
    <span class="pre-span" style="direction: ltr; text-align: left">choosing[i] := true;</span>
    <span class="pre-span" style="direction: ltr; text-align: left">number[i] := max(number[0], number[1], ..., number[n - 1])+1;</span>
    <span class="pre-span" style="direction: ltr; text-align: left">choosing[i] := false;</span>
    <span class="pre-span" style="direction: ltr; text-align: left">for j := 0 to n - 1</span>
        <span class="pre-span" style="direction: ltr; text-align: left">do begin</span>
            <span class="pre-span" style="direction: ltr; text-align: left">while choosing[j] do no-op;</span>
            <span class="pre-span" style="direction: ltr; text-align: left">while number[j] != 0</span>
                <span class="pre-span" style="direction: ltr; text-align: left">and (number[j], j) &lt; (number[i], i) do no-op;</span>
        <span class="pre-span" style="direction: ltr; text-align: left">end;</span>

        <span class="pre-span" style="direction: ltr; text-align: left">critical section</span>
    
    <span class="pre-span" style="direction: ltr; text-align: left">number[i] := 0;</span>
    
        <span class="pre-span" style="direction: ltr; text-align: left">remainder section</span>

<span class="pre-span" style="direction: ltr; text-align: left">until false;</span>
</pre><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <strong>&#x8BF4;&#x660E; - </strong></span> <br> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x9996;&#x5148;&#xFF0C;&#x8BE5;&#x8FC7;&#x7A0B;&#x5C06;&#x5176;&#x201C;&#x9009;&#x62E9;&#x201D;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;&#x4E3A;TRUE&#xFF0C;&#x8868;&#x793A;&#x5176;&#x610F;&#x56FE;&#x8FDB;&#x5165;&#x4E34;&#x754C;&#x533A;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x7136;&#x540E;&#x4E3A;&#x5176;&#x5206;&#x914D;&#x4E0E;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x5BF9;&#x5E94;&#x7684;&#x6700;&#x9AD8;&#x7968;&#x53F7;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x7136;&#x540E;&#x201C;&#x9009;&#x62E9;&#x201D;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;&#x4E3A;FALSE&#xFF0C;&#x8868;&#x793A;&#x5B83;&#x73B0;&#x5728;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7968;&#x53F7;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x8FD9;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x7B97;&#x6CD5;&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x548C;&#x6700;&#x4EE4;&#x4EBA;&#x56F0;&#x60D1;&#x7684;&#x90E8;&#x5206;&#x3002;</span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5B83;&#x672C;&#x8EAB;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x7684;&#x5173;&#x952E;&#x90E8;&#x5206;&#xFF01;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x524D;&#x4E09;&#x884C;&#x7684;&#x76EE;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x8FDB;&#x7A0B;&#x6B63;&#x5728;&#x4FEE;&#x6539;&#x5176;TICKET&#x503C;&#xFF0C;&#x90A3;&#x4E48;&#x6B64;&#x65F6;&#x4E0D;&#x5E94;&#x5141;&#x8BB8;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x68C0;&#x67E5;&#x5176;&#x65E7;&#x7968;&#x8BC1;&#x503C;&#xFF0C;&#x8BE5;&#x503C;&#x73B0;&#x5DF2;&#x8FC7;&#x65F6;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5728;&#x68C0;&#x67E5;&#x7968;&#x8BC1;&#x503C;&#x4E4B;&#x524D;&#x5728;for&#x5FAA;&#x73AF;&#x4E2D;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x90FD;&#x5C06;&#x201C;choose&#x201D;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;&#x4E3A;FALSE&#x3002;</span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x68C0;&#x67E5;&#x8FDB;&#x7A0B;&#x7684;&#x7968;&#x8BC1;&#x503C;&#xFF0C;&#x5176;&#x4E2D;&#x5177;&#x6709;&#x6700;&#x5C11;&#x7968;&#x53F7;/&#x8FDB;&#x7A0B;ID&#x7684;&#x8FDB;&#x7A0B;&#x8FDB;&#x5165;&#x5173;&#x952E;&#x90E8;&#x5206;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x9000;&#x51FA;&#x90E8;&#x5206;&#x53EA;&#x662F;&#x5C06;&#x7968;&#x8BC1;&#x503C;&#x91CD;&#x7F6E;&#x4E3A;&#x96F6;&#x3002;</span> </p><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <b>Code  -</b>&#x8FD9;&#x662F;Bakery&#x7B97;&#x6CD5;&#x7684;C&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x3002;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x5728;<b>UNIX&#x73AF;&#x5883;&#x4E2D;</b>&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4; -</span> </p><p><!-- To show strongly recommend and practice link    --></p><div id="practiceLinkDiv"><h2 class="sigil_not_in_toc"> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"> <a href="https://ide.geeksforgeeks.org/">&#x5EFA;&#x8BAE;&#xFF1A;&#x5728;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4E4B;&#x524D;&#xFF0C;&#x8BF7;&#x5148;&#x5728;<b><i><u>{IDE}</u></i></b>&#x4E0A;&#x5C1D;&#x8BD5;&#x60A8;&#x7684;&#x65B9;&#x6CD5;&#x3002;</a></span> </h2></div><br><!-- post_top_responsive --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9465609616171866" data-ad-slot="4501693235" data-ad-format="auto"></ins><br><div class="noIdeBtnDiv">
<pre class="brush: c; title: ; notranslate" title="">// Importing the thread library
#include &quot;pthread.h&quot;

#include &quot;stdio.h&quot;

// Importing POSIX Operating System API library
#include &quot;unistd.h&quot;

#include &quot;string.h&quot;

// This is a memory barrier instruction.
// Causes compiler to enforce an ordering
// constraint on memory operations.
// This means that operations issued prior
// to the barrier will be performed
// before operations issued after the barrier.
#define MEMBAR __sync_synchronize()
#define THREAD_COUNT 8

volatile int tickets[THREAD_COUNT];
volatile int choosing[THREAD_COUNT];

// VOLATILE used to prevent the compiler
// from applying any optimizations.
volatile int resource;

void lock(int thread)
{

    // Before getting the ticket number
    //&quot;choosing&quot; variable is set to be true
    choosing[thread] = 1;

    MEMBAR;
    // Memory barrier applied

    int max_ticket = 0;

    // Finding Maximum ticket value among current threads
    for (int i = 0; i &lt; THREAD_COUNT; ++i) {

        int ticket = tickets[i];
        max_ticket = ticket &gt; max_ticket ? ticket : max_ticket;
    }

    // Allotting a new ticket value as MAXIMUM + 1
    tickets[thread] = max_ticket + 1;

    MEMBAR;
    choosing[thread] = 0;
    MEMBAR;

    // The ENTRY Section starts from here
    for (int other = 0; other &lt; THREAD_COUNT; ++other) {

        // Applying the bakery algorithm conditions
        while (choosing[other]) {
        }

        MEMBAR;

        while (tickets[other] != 0 &amp;&amp; (tickets[other]
                                           &lt; tickets[thread]
                                       || (tickets[other]
                                               == tickets[thread]
                                           &amp;&amp; other &lt; thread))) {
        }
    }
}

// EXIT Section
void unlock(int thread)
{

    MEMBAR;
    tickets[thread] = 0;
}

// The CRITICAL Section
void use_resource(int thread)
{

    if (resource != 0) {
        printf(&quot;Resource was acquired by %d, but is still in-use by %d!\n&quot;,
               thread, resource);
    }

    resource = thread;
    printf(&quot;%d using resource...\n&quot;, thread);

    MEMBAR;
    sleep(2);
    resource = 0;
}

// A simplified function to show the implementation
void* thread_body(void* arg)
{

    long thread = (long)arg;
    lock(thread);
    use_resource(thread);
    unlock(thread);
    return NULL;
}

int main(int argc, char** argv)
{

    memset((void*)tickets, 0, sizeof(tickets));
    memset((void*)choosing, 0, sizeof(choosing));
    resource = 0;

    // Declaring the thread variables
    pthread_t threads[THREAD_COUNT];

    for (int i = 0; i &lt; THREAD_COUNT; ++i) {

        // Creating a new thread with the function
        //&quot;thread_body&quot; as its thread routine
        pthread_create(&amp;threads[i], NULL, &amp;thread_body, (void*)((long)i));
    }

    for (int i = 0; i &lt; THREAD_COUNT; ++i) {

        // Reaping the resources used by
        // all threads once their task is completed !
        pthread_join(threads[i], NULL);
    }

    return 0;
}
</pre></div><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()">&#x8F93;&#x51FA;&#xFF1A;</span> <br><img src="../../../imgs/os/64d500d24baa820a70e448273d511c54.jpg" alt="&#x4EA7;&#x91CF;"></p><br><!-- post_bottom_responsive --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9465609616171866" data-ad-slot="8385097921" data-ad-format="auto"></ins><br><br><hr><hr><!-- .entry-meta --></div></body></html>